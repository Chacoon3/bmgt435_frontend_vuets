import{j as C,D as V,E as N,C as $,G as P,H as g,I as D,J as L,d as B,o as a,c as l,b as t,t as v,f as i,q as k,F as y,A as w,_ as E,r as U,g as b,e as q,n as A,p as Y,a as z}from"./index-56a4a321.js";import{I as K}from"./InLineMsg-9ae81f13.js";const{currentUser:r}=$(),m=C(!1),d=C(null);function H(){r.value&&r.value.group_id!==null?(m.value=!0,P(g.groups.get,{id:r.value.group_id},e=>{e.status===200?d.value=e.data:d.value=null,m.value=!1})):(d.value=null,m.value=!1)}V(r,e=>{e==null||e.group_id===null?(d.value=null,m.value=!1):H()},{immediate:!0});function O(){return{isCurrentGroupLoading:m,currentGroup:d,getCurrrentGroup:H}}function Q(){const{isLoading:e,data:o,getData:n,clearCache:u}=N(g.groups.paginated);return V(d,()=>{u(),n()}),{isLoading:e,data:o,getData:n}}function R(){const e=C(!1);function o(n=null){e.value=!0,D(g.groups.create,null,u=>{e.value=!1,u.status===201?(r.value!==null&&(r.value.group_id=u.data.id),d.value=u.data,L(g.groups.paginated)):d.value=null,n==null||n(u)})}return{isCreatingGroup:e,createGroup:o}}function T(){const e=C(!1);function o(n,u=null){e.value=!0,D(g.groups.join,{group_id:n},p=>{e.value=!1,p.status===200&&(r.value!==null&&(r.value.group_id=p.data.id),d.value=p.data,L(g.groups.paginated)),u==null||u(p)})}return{isJoiningGroup:e,joinGroup:o}}function W(){const e=C(!1);function o(n=null){e.value=!0,D(g.groups.leave,null,u=>{e.value=!1,u.status===200&&(r.value!==null&&(r.value.group_id=null),d.value=null,L(g.groups.paginated)),n==null||n(u)})}return{isLeavingGroup:e,leaveGroup:o}}const X={id:"groupItemContainer"},Z={class:"groupName"},ee=["disabled"],te=B({__name:"GroupItem",props:{id:{},name:{},users:{}},setup(e){const o=e,{isJoiningGroup:n,joinGroup:u}=T(),{currentUser:p}=$();function h(){if(o.id===null)throw new Error("group id is null");u(o.id)}return(G,I)=>(a(),l("div",X,[t("span",Z,v(G.$props.name),1),i(p)&&i(p).group_id===null?(a(),l("button",{key:0,class:"normalButton",onClick:h,disabled:i(n)===!0},v(i(n)===!0?"Joining...":"Join"),9,ee)):k("",!0),t("div",null,[(a(!0),l(y,null,w(G.$props.users,_=>(a(),l("li",{class:"groupUser",key:_.id},v(_==null?void 0:_.first_name)+" "+v(_==null?void 0:_.last_name),1))),128))])]))}});const oe=E(te,[["__scopeId","data-v-08924502"]]),f=e=>(Y("data-v-72131dae"),e=e(),z(),e),ne={id:"groupViewContainer"},ue={key:0,class:"groupDiv"},se=f(()=>t("h2",{class:"groupDivH2"},"Fetching Data...",-1)),ae=[se],ie={key:1,class:"groupDiv"},le=f(()=>t("h2",{class:"groupDivH2"},"Create a new group",-1)),re={id:"createGroupDiv"},de=["onSubmit"],pe={class:"createGroupEle"},_e=["value","disabled"],ce={key:2,class:"groupDiv"},ge=f(()=>t("h2",{class:"groupDivH2"},"Your Group",-1)),ve=f(()=>t("div",null,[t("h3",null,"Members:")],-1)),fe={id:"userGroupInfo"},he=["value","disabled"],Ge=f(()=>t("div",{id:"splitLine"},null,-1)),me={class:"groupDiv"},Ce=f(()=>t("h2",{class:"groupDivH2"},"Group List",-1)),ye={key:0},we={key:1},De=B({__name:"GroupView",setup(e){const o=U({show:!1,msg:""}),{isCreatingGroup:n,createGroup:u}=R(),{isCurrentGroupLoading:p,currentGroup:h}=O(),{isLeavingGroup:G,leaveGroup:I}=W(),{isLoading:_,data:j,getData:x}=Q();x();function F(){o.show=!1,u(s=>{s.status===201?o.msg=(s==null?void 0:s.data)??"create group success!":o.msg=(s==null?void 0:s.data)??"create group failed!",o.show=!0})}function M(){I(s=>{s.status===200?o.msg=(s==null?void 0:s.data)??"leave group success!":o.msg=(s==null?void 0:s.data)??"leave group failed!",o.show=!0})}return(s,J)=>{var S;return a(),l("div",ne,[i(p)?(a(),l("div",ue,ae)):i(h)===null?(a(),l("div",ie,[le,t("div",re,[t("form",{onSubmit:b(F,["prevent"])},[t("div",null,[q(K,{show:o.show,content:o.msg},null,8,["show","content"])]),t("div",pe,[t("input",{type:"submit",value:i(n)?"Creating...":"Create!",disabled:i(n)},null,8,_e)])],40,de)])])):(a(),l("div",ce,[ge,t("div",null,[t("h3",null,v(i(h).name),1)]),ve,t("div",null,[t("ul",fe,[(a(!0),l(y,null,w(i(h).users,c=>(a(),l("li",{key:c.id},[t("span",null,v(c.first_name+" "+c.last_name),1)]))),128))])]),t("input",{type:"submit",value:i(G)?"Leaving...":"Leave group",disabled:i(G),onClick:J[0]||(J[0]=c=>M())},null,8,he)])),Ge,t("div",me,[Ce,t("div",null,[i(_)?(a(),l("h3",ye,"Fetching data...")):(a(),l("ul",we,[(a(!0),l(y,null,w((S=i(j))==null?void 0:S.data,c=>(a(),A(oe,{key:c.id,name:c.name,id:c.id,users:c.users},null,8,["name","id","users"]))),128))]))])])])}}});const Je=E(De,[["__scopeId","data-v-72131dae"]]);export{Je as default};
